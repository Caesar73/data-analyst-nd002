<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script src="http://datamaps.github.io/scripts/datamaps.world.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/numeral.js/1.4.5/numeral.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>

  <div id="container" style="position: fixed; top: 50; left: 50; width: 1050px; height: 650px; border: 1px solid #73AD21;"></div>

  <pre id="csv" style="display:none">Rank,City,Country,2014,1990,Growth,Country_code,Latitude,Longitude
1,Tokyo,Japan,37833000,32530000,16.30,JPN,35.6895,139.6917
2,Delhi,India,24953000,9726000,156.56,IND,28.7041,77.1025
3,Shanghai,China,22991000,7823000,193.89,CHN,31.2304,121.4737
4,Mexico City,Mexico,20843000,15642000,33.25,MEX,23.6345,-102.5528
5,SÃ£o Paulo,Brazil,20831000,14776000,40.98,BRA,-23.5505,-46.6333
6,Mumbai,India,20741000,12436000,66.78,IND,19.076,72.8777
7,Osaka,Japan,20123000,18389000,9.43,JPN,34.6937,135.5022
8,Beijing,China,19520000,6788000,187.57,CHN,39.9042,116.4074
9,New York/Newark,United States,18591000,16086000,15.57,USA,40.7128,-74.0059
10,Cairo,Egypt,18419000,9892000,86.20,EGY,30.0444,31.2357
11,Dhaka,Bangladesh,16982000,6621000,156.49,BGD,23.8103,90.4125
12,Karachi,Pakistan,16126000,7147000,125.63,PAK,24.8615,67.0099
13,Buenos Aires,Argentina,15024000,10513000,42.91,ARG,-34.6037,-58.3816
14,Calcutta,India,14766000,10890000,35.59,IND,22.5726,88.3639
15,Istanbul,Turkey,13954000,6522000,113.95,TUR,41.0082,28.9784
16,Chongqing,China,12916000,4011000,222.01,CHN,29.5630,106.5515
17,Rio de Janeiro,Brazil,12825000,9697000,32.26,BRA,-22.9068,-43.1729
18,Manila,Philippines,12764000,7973000,60.09,PHL,14.5995,120.9842
19,Lagos,Nigeria,12614000,4764000,164.78,NGA,6.5244,3.3792
20,Los Angeles/Long Beach/Santa Ana,United States,12308000,10883000,13.09,USA,34.0522,-118.2437</pre>

  <style>

    body {background-color: aliceblue;}

    h1 {color: darkgreen;}

    h2 {text-align: center; color: forestgreen;} 

  </style>
  <script type="text/javascript">  
    d3.select("body")
      .append("h1")
      .text("P6: Make Effective Data Visualization");

    d3.select("body")
      .append("h2")
      .text("Population Growth for 20 Largest Cities from 1990 to 2014");

  </script>
</head>

<body>
  <script type="text/javascript">
 
    var map = new Datamap({
      element: document.getElementById('container'),
    });

    function getRandomIntInclude(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min + 1)) + min;
      };

    var random10 = getRandomIntInclude(1, 10);

    var defaultOptions = {
    scope: 'world', 
    setProjection: setProjection, 
    projection: 'equirectangular', 
    height: null, //if not null, datamaps will grab the height of 'element'
    width: null, //if not null, datamaps will grab the width of 'element'
    responsive: false, //if true, call `resize()` on the map object when it should adjust it's size
    done: function() {}, //callback when the map is done drawing
    fills: {
      defaultFill: '#ABDDA4' //the keys in this object map to the "fillKey" of [data] or [bubbles]
    },
    dataType: 'json', //for use with dataUrl, currently 'json' or 'csv'. CSV should have an `id` column
    dataUrl: null, //if not null, datamaps will attempt to fetch this based on dataType ( default: json )
    geographyConfig: {
        dataUrl: null, //if not null, datamaps will fetch the map JSON (currently only supports topojson)
        hideAntarctica: true,
        borderWidth: 1,
        borderOpacity: 1,
        borderColor: '#FDFDFD',
        popupTemplate: function(geography, data) { //this function should just return a string
          return '<div class="hoverinfo"><strong>' + geography.properties.name + '</strong></div>';
        },
        popupOnHover: true, //disable the popup while hovering
        highlightOnHover: true,
        highlightFillColor: '#FC8D59',
        highlightBorderColor: 'rgba(250, 15, 160, 0.2)',
        highlightBorderWidth: 2,
        highlightBorderOpacity: 1
    },
    bubblesConfig: {
        borderWidth: 2,
        borderOpacity: 1,
        borderColor: '#FFFFFF',
        popupOnHover: true,
        radius: null,
        popupTemplate: function(geography, data) {
          return '<div class="hoverinfo"><strong>' + data.name + '</strong></div>';
        },
        fillOpacity: 0.75,
        animate: true,
        highlightOnHover: true,
        highlightFillColor: '#FC8D59',
        highlightBorderColor: 'rgba(250, 15, 160, 0.2)',
        highlightBorderWidth: 2,
        highlightBorderOpacity: 1,
        highlightFillOpacity: 0.85,
        exitDelay: 100,
        key: JSON.stringify
    },
    arcConfig: {
      strokeColor: '#DD1C77',
      strokeWidth: 1,
      arcSharpness: 1,
      animationSpeed: 600
    }
  };

    var colors = d3.scale.category10();

    window.setInterval(function() {
      map.updateChoropleth({
        USA: colors(Math.random() * 10),
        JPN: colors(Math.random() * 20),
        BRA: colors(Math.random() * 30),
        CHN: colors(Math.random() * 40),
        IND: colors(Math.random() * 50),
        PHL: colors(Math.random() * 60),
        NGA: colors(Math.random() * 70),
        TUR: colors(Math.random() * 80),
        ARG: colors(Math.random() * 90),
        EGY: colors(Math.random() * 100),
        BGD: colors(Math.random() * 110),
        PAK: colors(Math.random() * 120),
        MEX: colors(Math.random() * 130)
      });

 //     map.labels({labelColor: 'darkgreen', fontSize: 20, lineWidth: 2});
    }, 2000);

    debugger;

    map.bubbles([], {
      popupTemplate: function(geo, data) { 
        return "<div class='hoverinfo'>" + data.name + " - " + numeral(data.radius*5).format('0.00') + "%";
      }
    });
     
    window.setInterval(function() {
      map.bubbles.updateChoropleth({
        1: colors(Math.random() * 10),
        2: colors(Math.random() * 20),
        3: colors(Math.random() * 30),
        4: colors(Math.random() * 40),
        5: colors(Math.random() * 50),
        6: colors(Math.random() * 60),
        7: colors(Math.random() * 70),
        8: colors(Math.random() * 80),
        9: colors(Math.random() * 90),
        10: colors(Math.random() * 100),
        11: colors(Math.random() * 110),
        12: colors(Math.random() * 120),
        13: colors(Math.random() * 130)
      });
    }, 2000);       


  </script>
</body>
</html>
