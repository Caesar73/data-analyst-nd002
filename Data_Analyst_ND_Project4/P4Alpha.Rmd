---
title: "P4: Explore and Summarize Data. Data of the Bank of Russia"
author: "Olga Belitskaya"
date: '28 августа 2016 г '
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1. Tools

##### Let's start the description of the project with definition of working tools: the directory for storing generated files, the list of downloaded packages and the collection of useful links.

## 1.1 Setup Working Directory
'/Users/olgabelitskaya/projects/nd002/Data_Analyst_ND_Project4'

https://github.com/OlgaBelitskaya/data-analyst-nd002/tree/master/Data_Analyst_ND_Project4

```{r echo=FALSE, Working_Directory}
setwd('/Users/olgabelitskaya/projects/nd002/Data_Analyst_ND_Project4')
p='/Users/olgabelitskaya/projects/nd002/Data_Analyst_ND_Project4/figure_html/'
```

## 1.2 Useful links

1) http://www.theanalysisfactor.com/interpreting-regression-coefficients/

2) http://docs.ggplot2.org/current/coord_trans.html

3) https://www.r-bloggers.com/interpreting-regression-coefficient-in-r/?utm_source=feedburner&utm_medium=email&utm_campaign=Feed%3A+RBloggers+%28R+bloggers%29

4) http://personality-project.org/r/html/corr.test.html

5) https://rpubs.com/hadley/ggplot2-layers

6) http://rmarkdown.rstudio.com/articles_integration.html

7) https://http://blog.yhat.com/posts/r-lm-summary.html

8) http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/

9) http://data.princeton.edu/R/linearModels.html

10) https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf

## 1.3 Libraries

List of the libraries: 
devtools, knitr, markdown, ggplot2, ggthemes, RColorBrewer, gridExtra, scales,
reshape2, plyr, GGally, dplyr, tidyr, xlsx, lubridate, plotly, etc.

```{r echo=FALSE, message=FALSE, warning=FALSE, Libraries_1}
library(devtools)
library(knitr)
library(markdown)
library(ggplot2)
library(ggthemes)
library(RColorBrewer)
library(gridExtra)
library(scales)
library(reshape2)
library(plyr)
library(GGally)
library(dplyr)
library(tidyr)
library(xlsx)
library(lubridate)
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Libraries_2}
library(corrplot)
library(PerformanceAnalytics)
library(plotly)
library(RCurl)
library(bitops)
library(memisc)
library(dygraphs)
library(xts)
```

# 2. Data

## 2.1 Introduction

##### I have chosen an open database of quotations of currencies and precious metals located on the site of the Bank of Russia. 

http://www.cbr.ru/Eng/hd_base/

##### I think it is easy to visualize the analysis of variables and dependencies in this case. From publicly available data the file in xlsx format has been generated and downloaded.

## 2.2 Load the Data and Review

##### Using suitable functions (read.xlsx, data.frame) I had read the file as a dataframe. It was called "centrobank".

```{r echo=FALSE, comment='', Data_1}
centrobank <- data.frame(read.xlsx("c_bank.xlsx",sheetName="Data",header=TRUE))
head(centrobank)
```

##### First, there were no values "NA" in this dataframe, it was specially checked.

```{r echo=FALSE, comment='', Data_2}
row.with.na <- apply(centrobank, 1, function(x){any(is.na(x))})
s <- sum(row.with.na)
cat('sum(row.with.na) = ', s)
```

##### Second, let us have a look on dataframe components (1128 observations of 20 variables; their types, values, etc.). Most of them have a numerical type.

```{r echo=FALSE, comment='', Data_3}
str(centrobank)
```

##### Third, we should notice variables that indicating exchange rates are measured in rubles, the prices of precious metals are denoted in rubles per gram, foreign exchange reserves and monetary gold reserves - in millions of US dollars for every month.

##### The special variable "dual currency basket" is calculated according to the formula: 0.55 USD + 0.45 EUR.

##### Foreign exchange reserves and monetary gold reserves consist of official datapoints for every month about the state reserves in Russia.

```{r echo=FALSE, comment='', Data_4}
summary(centrobank)
```

##### Finally, as we could see some variables (foreign_exchange_reserves, monetary_gold) have the wrong type. It means the investigation proceeds to the next step.

## 2.3 Cleaning and Managing Data

##### With some special functions I added the right category (numerical) for foreign_exchange_reserves and monetary_gold.

```{r echo=FALSE, comment='', Data_5}
centrobank$temp1 <- gsub(" ","", centrobank$foreign_exchange_reserves)
centrobank$foreign_exchange_reserves <- as.numeric(centrobank$temp1)

centrobank$temp2 <- gsub(" ","", centrobank$monetary_gold)
centrobank$monetary_gold <- as.numeric(centrobank$temp2)

summary(centrobank$foreign_exchange_reserves)
summary(centrobank$monetary_gold)
```

```{r echo=FALSE, comment='', Data_6}
drops <- c("temp1","temp2")
centrobank <- centrobank[ , !(names(centrobank) %in% drops)]
```

##### For the next steps it would be useful to have variables with separated date indicators (days, months and years), so I had added these variables.

```{r echo=FALSE, comment='', Data_7}
centrobank$day= as.numeric(format(centrobank$date, "%d"))
centrobank$month = format(centrobank$date, "%B") 
centrobank$year = as.numeric(format(centrobank$date, "%Y"))
str(centrobank)
```

##### Now there are 23 variables in the dataset.

# 3. Univariate Plots Section

## 3.1 Univariate Plots

##### 3.1.1 Histograms of the distribution for all the analyzed variables.

##### The histogram for the distribution of the dual currency basket I put first, because I think it is the most important indicator for the economic situation in the currency market.

```{r  fig.width=8, fig.height=6, echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_0}
p0 <- ggplot(aes(x = dual_currency_basket), data = centrobank) + 
  geom_histogram(binwidth = 1, color = 'purple', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'dual currency basket, rubles', 
                     limits=c(32, 88), breaks=seq(32, 88, 2)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + 
  theme(axis.text.x=
          element_text(size=8,angle=85),axis.title=element_text(size=12))
p0
```

#### Then the histograms for the distribution of prices for precious metals in rubles were placed.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_1}
p1 <- ggplot(aes(x = gold), data = centrobank) + 
  geom_histogram(binwidth = 50, color = 'purple', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'gold, rubles per gram', 
                     limits=c(1200, 3200), breaks=seq(1200, 3200, 50)) + 
  scale_fill_gradientn(colours=heat.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_2}
p2 <- ggplot(aes(x = silver), data = centrobank) + 
  geom_histogram(binwidth = 0.5, color ='darkblue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'silver, rubles per gram', 
                     limits = c(19, 44), breaks = seq(19, 44, 0.5)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_3}
p3 <- ggplot(aes(x = platinum), data = centrobank) + 
  geom_histogram(binwidth = 50, color = 'darkmagenta', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'platinum, rubles per gram', limits = c(1200, 2800), breaks=seq(1200, 2800, 50)) + 
  scale_fill_gradientn(colours=heat.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_4}
p4 <- ggplot(aes(x = palladium), data = centrobank) + 
  geom_histogram(binwidth = 30, color = 'blue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'palladium, rubles per gram', limits = c(550, 1750), breaks=seq(550, 1750, 30)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r fig.width=14, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_5}
g101 <- grid.arrange(p1, p2, p3, p4, ncol = 2)
path01=paste(p, 'Univariate_Plots_5_1.png', sep = '')
ggsave(path01, g101, width = 18, height = 24) 
```

##### We will also examine the histograms for the distribution of prices for the main currencies in the Russian market (euro and dollars), as well as the histograms of foreign exchange reserves and monetary gold.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_6}
p101 <- ggplot(aes(x = EUR_978), data = centrobank) + 
  geom_histogram(binwidth = 1, color = 'navy', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'EUR, rubles', 
                     limits=c(38, 92), breaks=seq(38, 92, 2)) + 
  scale_fill_gradientn(colours=heat.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_7}
p102 <- ggplot(aes(x = USD_840), data = centrobank) + 
  geom_histogram(binwidth = 1, color ='darkblue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'USD, rubles', 
                     limits = c(28, 84), breaks = seq(28, 84, 2)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_8}
p103 <- ggplot(aes(x =foreign_exchange_reserves), data = centrobank) + 
  geom_histogram(binwidth = 5000, color = 'darkmagenta', aes(fill = ..count..))+ 
  scale_x_continuous(name = 'foreign exchange reserves, mln. USD', 
                     limits =c(305000, 490000),breaks=seq(305000,490000,10000))+ 
  scale_fill_gradientn(colours=cm.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_9}
p104 <- ggplot(aes(x = monetary_gold), data = centrobank) + 
  geom_histogram(binwidth = 500, color = 'blue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'monetary gold, mln.USD', limits = c(38500, 63500), breaks=seq(38500, 63500, 1000)) + 
  scale_fill_gradientn(colours=cm.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r fig.width=14, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_10}
g102 <- grid.arrange(p101, p102, p103, p104, ncol = 2)
path02=paste(p, 'Univariate_Plots_10_1.png', sep = '')
ggsave(path02, g102, width = 18, height = 24) 
```

##### To understand and predict the situation in the currency market it is necessary to discover the histograms of other currencies (Brazilian real, Japanese yen, Chinese yuan and Indian rupee).

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_11}
p105 <- ggplot(aes(x = BRL_986), data = centrobank) + 
  geom_histogram(binwidth = 0.25, color = 'navy', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'BRL, rubles', 
                     limits=c(13, 27), breaks=seq(13, 27, 0.5)) + 
  scale_fill_gradientn(colours=heat.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_12}
p106 <- ggplot(aes(x = JPY_392), data = centrobank) + 
  geom_histogram(binwidth = 0.01, color ='darkblue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'JPY, rubles', 
                     limits = c(0.3, 0.72), breaks = seq(0.3, 0.72, 0.02)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_13}
p107 <- ggplot(aes(x =CNY_156), data = centrobank) + 
  geom_histogram(binwidth = 0.2, color='darkmagenta', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'CNY, rubles', limits = c(4.4, 12.8), breaks=seq(4.4,12.8, 0.4)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_14}
p108 <- ggplot(aes(x = INR_356), data = centrobank) + 
  geom_histogram(binwidth = 0.02, color = 'blue', aes(fill = ..count..)) + 
  scale_x_continuous(name = 'INR, rubles', limits = c(0.45, 1.25), 
                     breaks=seq(0.45, 1.25, 0.04)) + 
  scale_fill_gradientn(colours=terrain.colors(20)) + 
  theme_bw() + theme(axis.text.x=element_text(size=8, angle=85),axis.title=element_text(size=12))
```

```{r fig.width=14, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_15}
g103 <- grid.arrange(p105, p106, p107, p108, ncol = 2)
path03=paste(p, 'Univariate_Plots_15_1.png', sep = '')
ggsave(path03, g102, width = 18, height = 24) 
```

##### 3.1.2 Plots for exchange rates (BRL 986, JPY 392, CNY 156, INR 356).

##### Let's have a look on behavior of rates for Brazilian real, Japanese yen, Chinese yuan and Indian rupee. In this case we could use the artificial variable "number" as a helpful indicator, not a real variable. The "number" shows only the serial number of observations for the variables in the dataset. So the next charts can be still regarded as univariate plots.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_16}
data_length = length(centrobank$BRL_986)
number = seq(1, data_length)

p5 <- ggplot(centrobank) + 
  geom_point(aes(x = number, y = BRL_986, color = number),size = 2, shape = 5) + 
  scale_colour_gradient2_tableau('Red-Blue') + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_17}
p6 <- ggplot(centrobank) + 
  geom_point(aes(x = number, y = JPY_392, color =number),size = 2, shape = 12) + 
  scale_colour_gradient2_tableau('Temperature') + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_18}
p7 <-ggplot(centrobank) + 
  geom_point(aes(x = number, y = CNY_156, color = number),size = 2, shape = 7) + 
  scale_colour_gradient2_tableau('Temperature') + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_19}
p8 <- ggplot(centrobank) + 
  geom_point(aes(x = number, y = INR_356, color = number),size = 2, shape = 9) + 
  scale_colour_gradient2_tableau('Temperature') + theme_bw()
```

```{r fig.width=14, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_20}
g2 <- grid.arrange(p5, p6, p7, p8, ncol = 2)
path04=paste(p, 'Univariate_Plots_20_1.png', sep = '')
ggsave(path04, g2, width = 18, height = 24) 
```

##### 3.1.3 Plots for foreign exchange and monetary gold reserves.

##### And for other two variables "foreign_exchange_reserves" and "monetary_gold" using the artificial indicator "number" is also convinient. We could see the changes step by step.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_21}
p9 <- ggplot(centrobank, aes(x = number, y=foreign_exchange_reserves, color = foreign_exchange_reserves)) + geom_jitter(size = 2, alpha=0.3, shape = 6) + scale_colour_gradientn(colours=rainbow(10)) + geom_smooth(aes(y=foreign_exchange_reserves), color = '#FF6633') + theme_bw() + ylab('foreign exchange reserves, millions of US dollars')
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_22}
p10 <- ggplot(centrobank, aes(x=number,y=monetary_gold,color = monetary_gold)) + 
  geom_jitter(size = 2, alpha=0.3, shape = 6) + 
  scale_colour_gradientn(colours=rainbow(10)) + 
  geom_smooth(aes(y=monetary_gold), color = '#00FFFF') + theme_bw() + 
  ylab('monetary gold reserves, millions of US dollars')
```

```{r fig.width=14, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_23}
g3 <- grid.arrange(p9, p10, ncol = 1)
path05=paste(p, 'Univariate_Plots_23_1.png', sep = '')
ggsave(path05, g3, width = 12, height = 24) 
```

##### 3.1.4 Box plots for every significant variable.

##### It helps to discover outliers for the indicators. I put together all the graphics for understanding outliers of economical variables in general. With color I divided them into groups: orange - USD and EUR, brown - Asian currencies, purple - Brazilian real, blue - precious metals, red - foreign exchange reserves, green - monetary gold.

##### I didn't include the variable "dual_currency_basket", it depends from EUR and USD and its outliers as well.

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_24}
p112 <- ggplot(centrobank, aes( x = 1, y = EUR_978)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'orange') +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=8, size=3)

p113 <- ggplot(centrobank, aes( x = 2, y = USD_840)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size= 1, color = 'orange') +
  stat_summary(fun.y=mean, colour="darkred", geom="point", 
               shape=8, size=3)

p114 <- ggplot(centrobank, aes( x = 3, y = JPY_392)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'brown') +
  stat_summary(fun.y=mean, colour="black", geom="point", 
               shape=8, size=3)

p115 <- ggplot(centrobank, aes( x = 4, y = CNY_156)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'brown') +
  stat_summary(fun.y=mean, colour="black", geom="point", 
               shape=8, size=3)

p116 <- ggplot(centrobank, aes( x = 5, y = INR_356)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'brown') +
  stat_summary(fun.y=mean, colour="black", geom="point", 
               shape=8, size=3)

p117 <- ggplot(centrobank, aes( x = 6, y = BRL_986)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'purple') + 
  stat_summary(fun.y=mean, colour="black", geom="point", 
               shape=8, size=3)

p120 <- ggplot(centrobank, aes( x = 9, y = gold)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'blue') +
  stat_summary(fun.y=mean, colour="darkblue", geom="point", 
               shape=8, size=3)

p121 <- ggplot(centrobank, aes( x = 10, y = silver)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'blue') +
  stat_summary(fun.y=mean, colour="darkblue", geom="point", 
               shape=8, size=3)  

p122 <- ggplot(centrobank, aes( x = 11, y = platinum)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, size = 1, color = 'blue') +
  stat_summary(fun.y=mean, colour="darkblue", geom="point", 
               shape=8, size=3)

p123 <- ggplot(centrobank, aes( x = 12, y = palladium)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, color = 'blue') + 
  stat_summary(fun.y=mean, colour="darkblue", geom="point", 
               shape=8, size=3)

p118 <- ggplot(centrobank, aes( x = 7, y = foreign_exchange_reserves)) + 
  geom_boxplot() +  geom_jitter(alpha=0.4, color = 'red') +
  stat_summary(fun.y=mean, colour="brown", geom="point", 
               shape=8, size=3)

p119 <- ggplot(centrobank, aes( x = 8, y = monetary_gold)) + geom_boxplot() +  
  geom_jitter(alpha=0.4, color = 'green') +
  stat_summary(fun.y=mean, colour="darkgreen", geom="point", 
               shape=8, size=3)
```

```{r fig.width=14, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots_25}
g104<- grid.arrange(p112, p113, p114, p115, p116, p117, 
                    p118, p119, p120, p121, p122, p123, ncol = 4)
path06=paste(p, 'Univariate_Plots_25_1.png', sep = '')
ggsave(path06, g104, width = 12, height = 24) 
```

##### All box plots have important indicators: min, max, median, quartiles. Means were marked with points.

##### X-axis is just a serial number of the box plot.

## 3.2. Univariate Analysis

##### The structure of my data is the set of the main financial indicators. Only with the first look at the data we could see the similar tendencies in many different cases. So we could predict many dependencies between our variables.

##### Also these indicators show the situation in the country economy in general. For sure it's an interesting subject for investigations.

##### The graphic description of histograms: most of them have a non-symmetrical form, skewed right and multimodal. For histograms where we could see a tendency to be unimodal I have used the heat palette of colors, for histograms that looks to have a tendency to be bimodal - the terrain palette of colors. In practice it means that the variables with unimodal histograms were stable at a certain interval for a sufficiently long period of time; for bimodal histograms there were two not so long periods of stability. Dispersion of all indicators is also quite large. 

##### The histograms for "foreign_exchange_reserves" and "monetary_gold" have a complicated form with many gaps. I have marked it with a special palette.

##### The significant price increase for precious metals in relation to the national currency allows us to consider that the precious metals are reasonable investment.

##### I didn't describe every histogram separately because many variables have very similar behaviour and distribution. We will see it much clearly on the next steps.

##### Next graphs show various exchange trends for the Brazilian real and the Asian currencies. The Brazilian real has one rise relative to the Russian ruble, Asian currencies have many peaks. However, there are certain similarities too: a period of small oscillations in the beginning of the chart gave way to a period of sharp spikes.

##### The plots for foreign exchange and monetary gold reserves demonstrate diametrically opposed situation in the resources in the second half of the time interval: the foreign exchange reserves show a downward trend, stocks of monetary gold - a steady rise.

##### Let's discuss outliers on the last graph in this section. When we see all of them, we can find immediately even without exact calculation of deviations from the general trend: there are too many outliers here. It shows the influence of the economical variables which are not included into this dataset. If we exclude outliers in this case we could lost important tendency and the material for next discoveries. If the reasons for many frequent and sharp deviations are not explained I want to see these data points in observation.

# 4 Bivariate Plots Section

## 4.1 Bivariate Plots

##### 4.1.1 Plots for all pairs of variables.

##### Let's start the section "Bivariate Plots" with graphs of the correlation analysis. It help to improve understanding the strong relationships between variables in this dataset.

```{r echo=FALSE, message=FALSE, warning=FALSE, comment='', Correlation_Plots_1}
corr_centrobank <-centrobank[, c(2,3,4,7,10,11,14,15,16,17,18,19,20)]
```

```{r fig.width=18, fig.height=24, echo=FALSE, message=FALSE, warning=FALSE, comment='', Correlation_Plots_2}
chart.Correlation(corr_centrobank, histogram=TRUE, pch=19)
```

##### And one correlation chart else with a special color indicator for levels of relationships between variables.

```{r fig.width=12, fig.height=12, echo=FALSE, message=FALSE, warning=FALSE,echo=FALSE, Correlation_Plots_3}
mcorr_centrobank <- cor(corr_centrobank)
corrplot.mixed(mcorr_centrobank, lower="number", upper="pie", order ="AOE", tl.col="darkblue", tl.cex=0.5)
```

##### The tables show a strong correlation between the number of variables, we will examine in detail only some of them.

##### 4.1.2 Plots for prices of precious metals and the dual currency basket.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_3}
p11 <- ggplot(centrobank, aes(x=dual_currency_basket, y=gold, color = gold)) + geom_point() + geom_smooth(color = 'darkred') + scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_4}
p12 <- ggplot(centrobank, aes(x=dual_currency_basket,y=silver,color = silver)) + geom_point() + geom_smooth(color = 'darkgreen') + scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_5}
p13 <- ggplot(centrobank, aes (x=dual_currency_basket, y=platinum, 
                               color = platinum)) + geom_point() + 
  geom_smooth(color='darkred') + 
  scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_6}
p14 <- ggplot(centrobank, aes (x=dual_currency_basket, y=palladium, 
                               color = palladium)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r fig.width=14, fig.height=8, echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_7}
g4 <- grid.arrange(p11, p12, p13, p14, ncol = 2)
path07=paste(p, 'Bivariate_Plots_7_1.png', sep = '')
ggsave(path07, g4, width = 18, height = 24) 
```

##### The graph for variables "silver" and "dual currency basket" has the most complex structure. The rest of the graphics in this section are quite close to the linear tendency (especially for the pair "gold" and "dual currency basket").

##### 4.1.3 Plots for Asian exchange rates and the dual currency basket.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_8}
p15 <- ggplot(centrobank, aes(x=dual_currency_basket,y=JPY_392,color=JPY_392)) + geom_point() + geom_smooth(color = 'darkred') + scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_9}
p16 <- ggplot(centrobank,aes(x=dual_currency_basket,y=CNY_156,color = CNY_156))+ geom_point() + geom_smooth(color = 'darkred') + scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_10}
p17 <- ggplot(centrobank,aes(x=dual_currency_basket,y=INR_356,color=INR_356)) + 
  geom_point() + geom_smooth(color='darkred')+ 
  scale_colour_gradientn(colours=heat.colors(10)) + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_11}
p18 <- ggplot(centrobank, aes (x=JPY_392, y=CNY_156, color = CNY_156)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_12}
p19 <- ggplot(centrobank, aes (x=CNY_156, y=INR_356, color = INR_356)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_13}
p20 <- ggplot(centrobank, aes (x=JPY_392, y=INR_356, color = INR_356)) + 
  geom_point() + geom_smooth(color = 'darkgreen') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
```

```{r fig.width=14, fig.height=12, echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_14}
g5 <- grid.arrange(p15, p16, p17, p18, p19, p20, ncol = 3)
path08=paste(p, 'Bivariate_Plots_14_1.png', sep = '')
ggsave(path08, g5, width = 18, height = 24) 
```

##### It's surprising how identical the trends which Asian currencies demonstrate.

##### 4.1.4 Plots for foreign exchange reserves and monetary gold reserves.

```{r echo=FALSE, message=FALSE, warning=FALSE, Bivariate_Plots_15}
p21 <- ggplot(centrobank, aes (x=foreign_exchange_reserves, 
                               y=monetary_gold, color = monetary_gold)) + 
  geom_jitter(shape = 13, size = 4) + geom_smooth(color = '#00FF99') + 
  scale_colour_gradientn(colours=terrain.colors(10)) + theme_bw()
p21
path09=paste(p, 'Bivariate_Plots_15_1.png', sep = '')
ggsave(path09, p21, width = 12, height = 8)
```

##### There is a complex nonlinear dependency on the last graph, so let's discuss it in the next section.

## 4.2 Bivariate Analysis

##### Let's start with correlation tests for these plotted pairs of variables.

```{r echo=FALSE, message=FALSE, warning=FALSE, comment='', Correlation_Tests_1}
with(centrobank, cor.test(dual_currency_basket, gold))
with(centrobank, cor.test(dual_currency_basket, silver))
with(centrobank, cor.test(dual_currency_basket, platinum))
with(centrobank, cor.test(dual_currency_basket, palladium))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, comment='', Correlation_Tests_2}
with(centrobank, cor.test(dual_currency_basket, JPY_392))
with(centrobank, cor.test(dual_currency_basket, CNY_156))
with(centrobank, cor.test(dual_currency_basket, INR_356))
with(centrobank, cor.test(JPY_392, CNY_156))
with(centrobank, cor.test(JPY_392, INR_356))
with(centrobank, cor.test(INR_356, CNY_156))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, comment='', Correlation_Tests_3}
with(centrobank, cor.test(foreign_exchange_reserves, monetary_gold))
```

##### Most of the observed relationships have strong positive correlation (dual_currency_basket & gold, dual_currency_basket & platinum, dual_currency_basket & palladium, dual_currency_basket & JPY-392, dual_currency_basket & INR-356, dual_currency_basket & CNY-156, JPY-392 & CNY-156, JPY-392 & INR-356, INR-356 & CNY-156). A moderate positive relationship is between dual_currency_basket & silver; a weak negative relationship - between foreign_exchange_reserves & monetary_gold. 

##### The strongest relationship I had found is between dual_currency_basket & CNY-156.

##### The revealed dependencies are based on cause-and-effect relationships, the fall of the national currency value in relation to a set of major currencies undoubtedly leads to the fall of this indicator in relation to other currencies and precious metals. 

##### Even a weak relationship between foreign exchange reserves and monetary gold reserves does not look accidental: reduced confidence to the foreign exchange reserves of the state leads to the accumulation of resources in another equivalent.

# 5 Multivariate Plots Section

## 5.1 Multivariate Plots

##### 5.1.1 A plot for dual currency basket and gold price per year.

##### Here we will use the added variable "year" to analyze the relationships of the two other variables.

```{r fig.width=10, fig.height=6, echo=FALSE, comment='', message=FALSE, warning=FALSE, Multivariate_Plots_1}
p24 <- ggplot(centrobank, aes(x=dual_currency_basket, y = gold, color = year))+ 
  geom_point(shape=10, alpha=0.5, size = 2) + 
  facet_wrap( ~ year, ncol=3, scale = 'free') + geom_smooth() + 
  scale_colour_gradientn(colours=heat.colors(5)) + theme_bw()
  ggtitle('Gold prices and dual currency basket in 2012-2016, rubles')
path10=paste(p, 'Multivariate_Plots_1_1.png', sep = '')
ggsave(path10, p24, width = 18, height = 12)
```

##### 5.1.2 A plot for exchange rates (USD, EUR) and gold price.

```{r fig.width=8, fig.height=6, echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots_2}
pl1 <- plot_ly(centrobank, x=centrobank$EUR_978, y=centrobank$USD_840, 
               z=centrobank$gold, color = centrobank$gold, 
               text = paste(centrobank$date), 
               colors = 'Spectral', type="scatter3d", mode="markers", 
               marker = list(size = 8, symbol = "circle-open"))
pl1
```

##### I have purposely used the 3-dimensional image to show how limited the space wich contain the graph of these three indicators, it means there is also a strong connection between all these variables.

##### 5.1.3 A plot for prices of precious metals (gold, silver) and the dual currency basket.

```{r fig.width=8, fig.height=6, echo=FALSE, message=FALSE, warning=FALSE, Multivariate_Plots_3}
pl2 <- plot_ly(centrobank, x=centrobank$gold, y=centrobank$silver, 
               z=centrobank$dual_currency_basket, 
               color = centrobank$dual_currency_basket, 
               text = paste(centrobank$date), colors = 'Spectral', 
               type="scatter3d", mode="markers", 
               marker = list(size = 8, symbol = "diamond-open"))
pl2
```

##### By adding a variable "price of silver", we can see a different picture: a region of space occupied by the graph is much wider, and therefore the relationship between three variables (gold, silver and dual currency basket) is weaker.

## 5.2 Multivariate Analysis

##### The first graph shows the danger of some statistical predictions and conclusions. According the researches, the gold price is quite strongly dependent on the price of the dual currency basket, currency exchange rates and the prices of other precious metals, but in 2013 this indicator demonstrates a diametrically opposite behavior. This database does not allow to identify the factors that had such an influence. So, more deep researches are needed.

##### It is easy to see in the long time period that the prices of precious metals (for example, gold) and currencies show almost the same trend concerning the national currency. Only silver prices were different from everyone else. For this metal price dynamics in most cases is decreasing in the 2012-2014 period.

##### These conclusions are confirmed by three-dimensional graphics. Adding the price of silver as a variable had led to the considerable spread of the data.

## 5.3 OPTIONAL: Building the Linear Model.

##### We can construct a model of the dependence the price of gold on the price of the currency basket and the prices of other precious metals.

```{r echo=FALSE, message=FALSE, warning=FALSE, Building_Linear_Model}
m1 <- lm(gold ~ dual_currency_basket, data = centrobank)
m2 <- update(m1, ~ . + platinum)
m3 <- update(m2, ~ . + palladium)
m4 <- update(m3, ~ . + silver)
mtable(m1, m2, m3, m4)
```

##### All derived statistical coefficients unambiguously confirm the existence of relationships between these indicators and the fairly good quality of the constructed model.

# 6 Final Plots and Summary

### 6.1.1 Plot One

```{r fig.width=7, fig.height=7, echo=FALSE, message=FALSE, warning=FALSE,echo=FALSE, Plot_One_1}

gold_xts <- xts(centrobank$gold, order.by = centrobank$date, frequency=365) 
silver_xts <- xts(centrobank$silver, order.by = centrobank$date, frequency=365) 
platinum_xts <- xts(centrobank$platinum, order.by=centrobank$date,frequency=365)
palladium_xts <- xts(centrobank$palladium,order.by=centrobank$date,frequency=365)
metals <- cbind(gold_xts, silver_xts, platinum_xts, palladium_xts)
head(metals,5)
#dygraph(metals, ylab="prices of precious metals, rubles ", 
#        main="Data of Bank of Russia, 2012-2016") %>%
#  dySeries("..1",label="gold") %>%
#  dySeries("..2",label="silver") %>%
#  dySeries("..3",label="platinum") %>%
#  dySeries("..4",label="palladium") %>%
#  dyOptions(colors = RColorBrewer::brewer.pal(4), "Spectral") %>%
#  dyRangeSelector()

```

### 6.1.2 Description One

##### 

### 6.2.1 Plot Two

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Two_1}
p22 <- ggplot(data = centrobank, aes(x = date)) + 
  geom_point(aes(y=centrobank$gold), color = 'goldenrod1', shape=1, 
             alpha=0.7, size = 5) + 
  geom_smooth(aes(y=centrobank$gold), color = 'gold') + 
    geom_text(data=centrobank, mapping=aes(y=centrobank$gold), 
              label='G',size=4, color ='orange') +
  geom_point(aes(y=100*centrobank$silver), color = 'darkgrey', shape=1, 
             alpha=0.7, size = 5) + 
  geom_smooth(aes(y=100*centrobank$silver), color = 'grey') + 
  geom_text(data=centrobank, mapping=aes(y=100*centrobank$silver), 
            label='S',size=4, color ='black') +
  geom_point(aes(y=centrobank$palladium), color = 'brown', shape=1, 
             alpha=0.7, size = 5) + 
  geom_smooth(aes(y=centrobank$palladium), color = 'sienna2') +
  geom_text(data=centrobank, mapping=aes(y=centrobank$palladium),
            label='Pa', size=3, color ='#663300') +
  geom_point(aes(y=centrobank$platinum), color = 'darkcyan', shape=1, 
             alpha=0.7, size = 5) + 
  geom_smooth(aes(y=centrobank$platinum), color = 'darkseagreen3') +
  geom_text(data=centrobank, mapping=aes(y=centrobank$platinum), 
            label='Pl', size=3, color ='darkgreen') +
  ylab('1g palladium, 1g platinum, 100g siver, 1g gold prices') + 
  ggtitle('Data of Bank of Russia, Precious Metal Prices, 2012-2016') + theme_bw() +
  theme(axis.title.y = element_text(colour="grey20",size=16,angle=90,hjust=.5,vjust=.5,face="plain"))
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Two_2}
note1 = 'JPY'
note2 = 'USD'
note3 = 'EUR'
note4 = 'CNY'
note5 = 'INR'
x1 = centrobank[1000,1]
y1 = 100*centrobank[1000,7]
x2 = centrobank[4,1]
y2 = centrobank[4,4]
x3 = centrobank[7,1]
y3 = centrobank[7,3]
x4 = centrobank[920,1]
y4 = 10*centrobank[920,10]
x5 = centrobank[1080,1]
y5 = 100*centrobank[1080,14]
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Two_3}
p23 <- ggplot(data = centrobank, aes(x = date)) + 
  geom_point(aes(y=100*centrobank$JPY_392), color = 'darkred', 
             shape=10, alpha=0.7, size = 2) + 
  geom_point(aes(y=centrobank$USD_840, label=note2), color = 'darkblue', 
             shape=11, alpha=0.7, size = 2) + 
  geom_point(aes(y=centrobank$EUR_978), color = 'darkgreen', 
             shape=12, alpha=0.7, size = 2) + 
  geom_point(aes(y=10*centrobank$CNY_156), color = 'purple3', 
             shape=13, alpha=0.7, size = 2) + 
  geom_point(aes(y=100*centrobank$INR_356), color = 'orange', 
             shape=14, alpha=0.7, size = 2) + 
  geom_smooth(aes(y=100*centrobank$JPY_392), color = 'red') +  
  geom_smooth(aes(y=centrobank$USD_840), color = 'blue') +  
  geom_smooth(aes(y=centrobank$EUR_978), color = 'green') +  
  geom_smooth(aes(y=10*centrobank$CNY_156), color = 'magenta') +  
  geom_smooth(aes(y=100*centrobank$INR_356), color = 'yellow') + 
    annotate(geom="text",x=as.Date(x1),y=y1,label=note1,
             fontface="bold",size = 8,color = "red") +
  annotate(geom="text",x=as.Date(x2),y=y2,label=note2,
           fontface="bold",size = 8,color = "blue") +
  annotate(geom="text",x=as.Date(x3),y=y3,label=note3,
           fontface="bold",size = 8,color = "green") +
  annotate(geom="text",x=as.Date(x4),y=y4,label=note4,
           fontface="bold",size = 8,color="magenta") +
  annotate(geom="text",x=as.Date(x5),y=y5,label=note5,
           fontface="bold",size = 8,color="yellow") +
  ylab('100 JRY, USD, EUR, 10 CNY, 100 INR') + 
  ggtitle('Data of Bank of Russia, Currency Rates, 2012-2016') + theme_bw() + 
  theme(axis.title.y = element_text(colour="grey20",size=16,angle=90,hjust=.5,vjust=.5,face="plain"))
```

```{r fig.width=14, fig.height=20, echo=FALSE, message=FALSE, warning=FALSE, Plot_Two_4}
g11 <- grid.arrange(p22, p23, ncol=1)
path11=paste(p, 'Plot_Two_4_1.png', sep = '')
ggsave(path11, g11, width = 18, height = 24)
```

### 6.2.2 Description Two

##### The second graph shows the very similar behavior for all precious metals and currencies, exept silver. In the long time period they are related to each other strongly.

##### And once again we can see a period of small oscillations in the beginning of the chart and a period of sharp spikes in the end.

### 6.3.1 Plot Three

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Three_1}
p25 <- ggplot(centrobank, 
              aes(x=dual_currency_basket, 
                  y = (gold+silver+platinum+palladium)/4, color = year)) + 
  geom_point(shape=7, alpha=0.5, size = 2) + geom_smooth() + 
  scale_colour_gradientn(colours=rainbow(5)) + 
  ggtitle('Precious metals mean of prices and dual currency basket in 2012-2016,
          rubles') + theme_bw()
```

```{r echo=FALSE, message=FALSE, warning=FALSE, Plot_Three_2}
p26 <- ggplot(centrobank, 
              aes(x=dual_currency_basket, 
                  y = (gold+silver+platinum+palladium)/4, color = year)) + 
  geom_point(shape=7, alpha=0.5, size = 2) + 
  facet_wrap( ~ year, ncol=3, scale = 'free') + geom_smooth() + scale_colour_gradientn(colours=rainbow(5)) + 
  ggtitle('Precious metals mean of prices and dual currency basket in 2012-2016,
          rubles') + theme_bw()
```

```{r fig.width=14, fig.height=20, echo=FALSE, message=FALSE, warning=FALSE, Plot_Three_3}
g12 <- grid.arrange(p25, p26, ncol=1)
path12=paste(p, 'Plot_Three_3_1.png', sep = '')
ggsave(path12, g12, width = 18, height = 24)
```

### 6.3.2 Description Three

##### For the next step I had launched a new artificial variable - the arithmetic mean of the prices of precious metals. To the common database this variable was not added.

##### The third graph represents a great difference in behavior of economic indicators in the long time period and in the short time periods. It shows us clearly the influence of some unknown variables which are not represented in this dataset.

# 7 Reflection

##### The centrobank data set contains information on almost 1,100 days of measuring the economic indicators. The data description can be found in the file with this database on the second page.

##### In general it's a very difficult sphere for prediction because of many external factors, so for more correct researching I think it needs to have about 5000-10000 rows of data and some additional factors (oil prices, for example).

##### Working over this project, I have set for myself the task of training rather than a researching. I have been studying and applying the programming language R for the first time so I had chosen the lightest model for investigating, where economic relations between the variables are obvious.

##### For these goals different plotting techniques had been used. R has a very wide range of instruments, I hope I was able to learn at least some of them.

##### In addition, I have been studying to apply this language in the R-Studio and the Jupyter Notebook. In some cases, I was unable to apply the same methodology. For example, I would like to know how to use the plotly package in the Jupyter Notebook in the Anaconda environments, but it shows errors during installation. Maybe I could improve it a little bit later.

##### The broad field of research is ahead with the addition of more and more wide range of methods and indicators.
